#### CIERGB空间，光与颜色

##### 可见光
对于可见光，其不同的波长对应着不同的颜色。

随着波长增加，光的颜色由蓝逐渐向红转变。

![fig1.1](\pics\fig1.jpg)

##### 感受颜色

人能感受到颜色，依靠人眼中的视锥细胞。三种视锥细胞S，M，L分别对短波，中波，长波敏感，相当于对应识别了蓝，绿，红三色。

![fig1.2](\pics\fig2.webp)

- 尽管人眼只有识别三种颜色的细胞，但人可以感觉出更多的颜色。感觉取决于所能识别的三种颜色，红绿蓝的比例。
  - 例如黄光，其相当于同时激活了识别绿和红色的细胞，人可以感受到这是与绿，红并不相同的一种颜色。

##### 三原色光混合
由此，出现了三原色光的概念。
选取700nm、546.1nm、435.8nm波长对应的红，绿，蓝作为三原色光。

![fig1.3](\pics\fig3.webp)

由此，可以把任意一种单色光，人眼等效的用三原色光混合获得。

##### 人眼等效

实质上单色光如黄光，对应单一的波长，并不等同于红绿混合光。
但对于人眼来说，如前述，无论黄光，还是红绿混合光，都是同时激活了识别绿和红的细胞，从而让人脑海里产生了同样的颜色。

- 牛顿爵士借助三棱镜的光色散试验，将白光分解为了各种单色光。这说明（在光谱中也能发现），并没有纯白光，白只是人脑对各色光混合（或者说各种视锥细胞均被激活）后的感受。

下面即是白光灯的光谱（它的白是用如下强度的各种光构成的）

![fig1.4](\pics\fig4.jpg)

##### 混合比例

每种单色光，红绿蓝三原色以何种比例混合，可以让两者在人眼下等效？

经过对比试验。也就是让人同时观察单色光与混合光，在人感觉无差别时记录三原色光的强度，可获得RGB三刺激值，RGB代表红（Red），绿（Green），蓝（Blue）。


![fig1.5](\pics\fig5.png)

图中横坐标为波长，纵坐标为光强度。波长为λ的单色光，人眼下等效于图中横坐标λ处，以RGB三条曲线的纵坐标为强度的红绿蓝光混合。

即C(λ) = r(λ) + g(λ) + b(λ)

- 部分区间的红光负值意味着，指定的单色光无法直接等效于三色光混合，但单色光与红光的混合，可等效于蓝绿色光混合。
  - 相当于r(λ)<0时将公式移项，这样等式两边每一项都是正值。
  - C(λ) - r(λ) = g(λ) + b(λ)
- 图中的强度是调整后的相对值，实验中混合为等效白光的红绿蓝三色光强度为1.0000: 4.5907: 0.0601。但将其记录为1:1:1。所以图中纵坐标相同，并不代表两种色光绝对强度相同。

##### 逆变换不可行

从波长λ可获得RGB三种色光的混合比例，但RGB三色光以任意比例混合，却无法保证可获得人眼等效的单色光的波长。

- 人眼中红色与紫色混合为品红，但实际上并不存在品红的单色光，品红只是红蓝光一定比例混合后人脑内的感觉。

从光谱也可以看出，红与紫在光谱的两端，并没有相连接，只不过人脑将两者的混合形成了新的颜色感觉作为过渡，形成了循环的圆环。

![fig1.10](\pics\fig10.png)

##### CIERGB三维空间

由此，波长为λ单色光，根据三刺激值图可获得对应的三原色光混合强度R(λ),G(λ),B(λ)，将这三个值视作空间中的坐标。可获得一个空间中的光谱曲线：

![fig1.6](\pics\fig6.png)

将光谱曲线上的每个点与原点连线做延长线，填充空间（坐标值越大光强度越高），这样整个空间中就包含了不同光强度，不同混合比例等效的各种颜色，这就是CIERGB颜色空间。

##### CIErgb二维平面
将CIERGB空间的三个坐标RGB做归一化放缩，使其和=1。

r = R/(R+G+B), g = G/(R+G+B), b = B/(R+G+B)。

这样空间中的曲线可以不必记录RGB三个值，只需记录rgb中的两个，剩下一个可由1减去已知的两个来获得。

最终的二维CIErgb图只保留r和g。

![fig1.7](\pics\fig7.png)

-

- 白光按前述，由相对强度1:1:1的RGB三色光混合而成，因此白点在图中的坐标为r=1/3,g=1/3。

RGB归一化放缩本质上相当于将光谱曲线的每点与原点连线，向R+G+B=1平面投影。
![fig1.8](\pics\fig8.png)

- 这个降维操作损失了光的绝对强度信息，专注于RGB三色光的混合比例。
  - 例如CIERGB空间中的R=10,G=B=0以及R=0.1,G=B=0在投影后，均为r=1，g=b=0。因此无法从二维还原到三维CIERGB空间。

##### 下一步的CIEXYZ

![fig1.9](\pics\fig9.png)

上图为空白区域填色后的CIErgb二维图，从上图的红线已经可以看出接下来的处理方法：

由于r存在负值，下一步即通过线性变换，使该光谱曲线在红线对应的新坐标系下均为正值。也就是通过空间变换（矩阵乘法），将CIERGB空间转为CIEXYZ空间。



##### 代码

注意代码中的展示的光谱是用渐变调色形成的，只为粗略表示CIE空间，其颜色与波长对应并不严谨。